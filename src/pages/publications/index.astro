---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const allPosts = await getCollection("publications");

const posts = allPosts.sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime()
);

const formatAuthors = (authors: string[], authorNotes?: string[]) => {
  if (!authorNotes || authorNotes.length === 0) {
    return authors.join(", ");
  }
  
  return authors.map((author, index) => {
    if (authorNotes[index] && (authorNotes[index].toLowerCase().includes("equal") || authorNotes[index].toLowerCase().includes("ίση"))) {
      return `${author}*`;
    }
    return author;
  }).join(", ");
};
---

<BaseLayout title="Publications | Georgios Balaouras">
  <main class="mx-auto max-w-6xl px-6 py-12">
    <h1 class="text-4xl font-bold mb-6">Publications</h1>

    <div class="grid grid-cols-1 gap-8">
      {posts.map((post) => (
        <article class="rounded-xl border border-gray-200 dark:border-gray-700 p-6">
          <div class="flex flex-col md:flex-row gap-6">
            <div class="shrink-0 flex flex-col items-center">
              {post.data.featuredImage && (
                <a href={`/publications/${post.slug}`}>
                  <img
                    src={post.data.featuredImage}
                    alt={post.data.title}
                    class="w-48 h-32 object-cover rounded-lg mb-4"
                  />
                </a>
              )}
              
              <div class="flex flex-wrap gap-2 justify-center w-52">
                {post.data.doi && (
                  <a
                    href={`https://doi.org/${post.data.doi}`}
                    target="_blank"
                    class="inline-block rounded-md px-2 py-1.5 text-sm bg-slate-700 hover:bg-slate-600 text-white text-center min-w-[3.5rem]"
                  >
                    DOI
                  </a>
                )}
                
                {post.data.url_pdf && (
                  <a
                    href={post.data.url_pdf}
                    target="_blank"
                    class="inline-block rounded-md px-2 py-1.5 text-sm bg-slate-700 hover:bg-slate-600 text-white text-center min-w-[3.5rem]"
                  >
                    PDF
                  </a>
                )}

                {post.data.url_code && (
                  <a
                    href={post.data.url_code}
                    target="_blank"
                    class="inline-block rounded-md px-2 py-1.5 text-sm bg-slate-700 hover:bg-slate-600 text-white text-center min-w-[3.5rem]"
                  >
                    Code
                  </a>
                )}

                {post.data.url_video && (
                  <a
                    href={post.data.url_video}
                    target="_blank"
                    class="inline-block rounded-md px-2 py-1.5 text-sm bg-slate-700 hover:bg-slate-600 text-white text-center min-w-[3.5rem]"
                  >
                    Video
                  </a>
                )}

                {post.data.url_slides && (
                  <a
                    href={post.data.url_slides}
                    target="_blank"
                    class="inline-block rounded-md px-2 py-1.5 text-sm bg-slate-700 hover:bg-slate-600 text-white text-center min-w-[3.5rem]"
                  >
                    Slides
                  </a>
                )}

                {post.data.url_project && (
                  <a
                    href={post.data.url_project}
                    target="_blank"
                    class="inline-block rounded-md px-2 py-1.5 text-sm bg-slate-700 hover:bg-slate-600 text-white text-center min-w-[3.5rem]"
                  >
                    Project
                  </a>
                )}
              </div>
            </div>
            
            <div class="flex-1">
              <h2 class="text-2xl font-semibold mb-2">
                <a href={`/publications/${post.slug}`} class="hover:underline">
                  {post.data.title}
                </a>
              </h2>
              
              <p class="text-gray-600 dark:text-slate-400 mb-1">
                {post.data.publication} - <span class="italic">{post.data.date.toLocaleDateString("en-GB", { year: "numeric", month: "long" })}</span>
              </p>

              <p class="text-gray-700 dark:text-slate-300 mb-2">
                {formatAuthors(post.data.authors, post.data.author_notes)}
              </p>
              
              {post.data.author_notes && post.data.author_notes.some(n => n.toLowerCase().includes("equal")) && (
                <p class="text-xs text-gray-500 dark:text-slate-500 mb-4">* Equal contribution</p>
              )}

              <p class="text-gray-600 dark:text-slate-400">
                {post.data.summary}
              </p>
            </div>
          </div>
        </article>
      ))}
    </div>
  </main>
</BaseLayout>
